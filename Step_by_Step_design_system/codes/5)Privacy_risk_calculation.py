import numpy as np

emission_labels = [
    "$", ".", "Birthday_value", "EMAIL_value", "Home-address", 
    "IP address", "IP_value", "Last-Name", "Money-amount", 
    "Name", "SSN", "SSN_values", "bank balance", "birthday", 
     "charge", "credit card", "email","living", "owner","credit-value","seccode-value","securitycode","phone_value", 
     "bank_value","website_value", "zipcode_value","countryname_value","phone_number","bank_name","website", "zip-code","country",
]


transition_states = [
    'T4-T1', 'T1-St', 'T1-Na', 'T1-La','T1-Bi','T1-Ss','T2-Mo','T4-T2','T1-Count',
'T1-Pho','T1-Zip','T3-web','T4-T3', 'T3-Ip','T2-credit','T2-Secode','T3-Em','T2-bank','O'
]

transition_matrix = np.array([
    [0.0000, 0.1555, 0.3655, 0.0000, 0.0798, 0.1345, 0.0000, 0.0000, 0.0546, 0.1555, 0.0546, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
    [0.7027, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0811, 0.0000, 0.0000, 0.0000, 0.0000, 0.1892, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0270],
    [0.0000, 0.0000, 0.0000, 1.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
    [0.2451, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1863, 0.0000, 0.0000, 0.0000, 0.0000, 0.0980, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.4706],
    [0.0526, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.6316, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.3158],
    [0.1250, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.2812, 0.0000, 0.0000, 0.0000, 0.0000, 0.2188, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.3750],
    [0.4231, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0577, 0.0000, 0.0000, 0.0000, 0.0000, 0.2500, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.2692],
    [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.2737, 0.2737, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1895, 0.1895, 0.0000, 0.0737, 0.0000],
    [0.0769, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.3077, 0.0000, 0.0000, 0.0000, 0.0000, 0.2308, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.3846],
    [0.5946, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.3514, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0541],
    [0.3077, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1538, 0.0000, 0.0000, 0.0000, 0.0000, 0.3846, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1538],
    [0.4737, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1579, 0.0000, 0.0000, 0.0000, 0.0000, 0.3684, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
    [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1545, 0.0000, 0.2764, 0.0000, 0.0000, 0.5691, 0.0000, 0.0000],
    [0.4706, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.3235, 0.0000, 0.0000, 0.0000, 0.0000, 0.2059, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
    [0.3333, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.4722, 0.0000, 0.0000, 0.0000, 0.0000, 0.1111, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0833],
    [0.2778, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.4167, 0.0000, 0.0000, 0.0000, 0.0000, 0.1111, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1944],
    [0.6000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.2429, 0.0000, 0.0000, 0.0000, 0.0000, 0.0286, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1286],
    [0.2857, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.2857, 0.0000, 0.0000, 0.0000, 0.0000, 0.3571, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0714],
    [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000]
])


emission_matrix = np.array([
        

        [0.0000 ,          0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.1303  ,         0.0000  ,         0.0000 ,          0.0546 ,          0.0000     ,        0.0000 ,          0.0000 ,          0.1555 ,          0.3655 ,      0.0000,         0.0000 ,          0.0000,           0.0000 ,          0.0000,           0.0000 ,          0.0000 ,          0.0000,           0.1555,           0.0000,           0.0000,           0.0546,           0.0546 ] ,       

        [0.0000,           0.0000  ,         0.0000  ,         0.0000 ,          1.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000    ,       0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000,           0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ] ,      

        [0.0000 ,          0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000   ,        0.0000 ,          0.0000  ,         1.0000 ,          0.0000   ,        0.0000   ,        0.0000  ,         0.0000 ,          0.0000    ,       0.0000  ,         0.0000  ,         0.0000   ,        0.0000 ,          0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ]  ,      

        [0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         1.0000 ,          0.0000  ,         0.0000  ,         0.0000   ,        0.0000    ,       0.0000   ,        0.0000 ,          0.0000    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ] ,      

        [0.0000  ,         0.0000   ,        1.0000   ,        0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.0000   ,        0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000   ,        0.0000 ]  ,      

        [0.0000  ,         0.0000  ,         0.0000   ,        0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.9688   ,        0.0000  ,         0.0000  ,         0.0000    ,       0.0000   ,        0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0312   ,        0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000   ]  ,    

        [0.0000  ,         0.0000 ,          0.0000   ,        0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000   ,        1.0000  ,         0.0000  ,         0.0000    ,       0.0000   ,        0.0000  ,         0.0000  ,         0.0000    ,       0.0000   ,        0.0000   ,        0.0000   ,        0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000,           0.0000 ,         0.0000   ,        0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,          0.0000    ,       0.0000   ] ,     

        [0.2737  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000   ,        0.0000    ,       0.0947  ,         0.0000  ,         0.1789    ,       0.1895    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000 ,          0.0000   ,        0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000   ,        0.0000  ,         0.0000  ,         0.0737  ,         0.0000  ,         0.0000    ,       0.0000   ] ,     

         [0.0000 ,          0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000   ,        0.0000    ,       0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000   ,        1.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000   ,        0.0000 ],

        [0.0000  ,         0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000   ,        0.0000   ,        0.0000    ,       0.0000   ,        0.0000  ,         0.0000    ,       0.0000  ,         0.0000   ,        0.0000    ,       0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         1.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000   ,        0.0000  ,         0.0000    ,       0.0000   ] ,     

        [0.0000  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000    ,       0.0000   ,        0.0000    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          1.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000   ,        0.0000    ,       0.0000   ]  ,    

        [0.0000  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000    ,       0.0000  ,         0.0000    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,         1.0000  ,         0.0000   ,        0.0000   ,        0.0000  ,         0.0000   ,        0.0000   ,        0.0000     ,      0.0000     ] ,   

        [0.0000  ,         0.0000  ,         0.0000    ,       0.0000  ,         0.0000   ,        0.2764   ,        0.0000   ,        0.0000  ,         0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000   ,        0.0000  ,         0.0000     ,      0.0000   ,        0.5691   ,        0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,        0.1545    ,       0.0000     ,      0.0000   ]  ,    

        [0.0000 ,          0.0000 ,          0.0000   ,        0.0000 ,          0.0000  ,         0.0000  ,         1.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000   ,        0.0000  ,         0.0000    ,       0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000  ,         0.0000    ,       0.0000   ]  ,    

        [0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,         0.0000  ,         0.0000   ,        0.0000  ,         0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000    ,       0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         1.0000  ,         0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.0000   ,        0.0000  ,         0.0000   ,       0.0000    ,       0.0000    ,       0.0000     ,      0.0000   ]  ,    

        [0.0000  ,         0.0000,           0.0000   ,        0.0000 ,          0.0000   ,        0.0000  ,           0.0000  ,         0.0000   ,        0.0000   ,        0.0000  ,         0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000    ,       0.0000  ,         0.0000   ,        0.0000  ,         0.0000  ,         0.0000   ,        0.9722  ,         0.0000   ,        0.0000  ,         0.0000 ,          0.0000 ,          0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000   ,        0.0000     ,      0.0000   ]  ,    

        [0.0000 ,          0.0000 ,          0.0000  ,         1.0000 ,          0.0000 ,          0.0000  ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000,           0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000    ,       0.0000  ]  , 

        [0.0000 ,          0.0000 ,          0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          0.0000 ,          1.0000,           0.0000 ,          0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000    ,       0.0000  ]  ,    

        [ 0.0000  ,         1.0000 ,          0.0000   ,        0.0000  ,         0.0000  ,         0.0000  ,         0.0000,           0.0000   ,        0.0000   ,        0.0000   ,        0.0000    ,       0.0000  ,         0.0000  ,         0.0000   ,        0.0000     ,      0.0000   ,        0.0000    ,       0.0000  ,        0.0000  ,         0.0000   ,        0.0000   ,        0.0000  ,         0.0000  ,         0.0000 ,          0.0000  ,         0.0000  ,         0.0000    ,       0.0000  ,        0.0000   ,          0.0000    ,       0.0000      ,     0.0000   ]  ,                 

])


# Initialize uniform initial probabilities
initial_probabilities = np.full(len(transition_states), 1.0 / len(transition_states))

# Define the Forward Algorithm
def forward_algorithm(observations, transition_matrix, emission_matrix, initial_probabilities):
    """
    Forward Algorithm for HMM
    observations: Sequence of observed labels (indices in the emission matrix)
    transition_matrix: Transition probability matrix (states x states)
    emission_matrix: Emission probability matrix (states x observations)
    initial_probabilities: Initial state probabilities (size: states)
    """
    n_states = len(transition_states)  
    n_observations = len(observations) 

    # Initialize alpha matrix (forward probabilities)
    alpha = np.zeros((n_observations, n_states))

    # Initial step: Calculate the forward probabilities for the first observation
    first_observation = observations[0]
    alpha[0, :] = initial_probabilities * emission_matrix[:, first_observation]

    # Recursion: For each subsequent observation
    for t in range(1, n_observations):
        for s in range(n_states):
            alpha[t, s] = np.sum(alpha[t - 1, :] * transition_matrix[:, s]) * emission_matrix[s, observations[t]]

   
    total_probability = np.sum(alpha[-1, :])

    return total_probability, alpha

# Example observation sequence
observation_sequence = ["phone_number", "phone_value"]
observations = [emission_labels.index(label) for label in observation_sequence]

# Run the forward algorithm
probability, forward_probs = forward_algorithm(observations, transition_matrix, emission_matrix, initial_probabilities)


print(f"Transition Matrix:\n{transition_matrix}")
print(f"Emission Matrix:\n{emission_matrix}")
print(f"Total Probability of the Observation Sequence: {probability}")
print("Forward Probabilities Matrix:")
print(forward_probs)

# Calculate and print the final probability 
final_probability = np.sum(forward_probs[-1])  # Sum over the last time step
print(f"Final Probability (Sum of last time step): {final_probability}")
